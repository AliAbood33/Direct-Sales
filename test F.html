<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نموذج إدخال المشتريات</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            text-align: right;
            margin: 20px;
        }
        form {
            max-width: 400px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 2px 2px 12px #aaa;
        }
        label {
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #28a745;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <h2>نموذج إدخال المشتريات</h2>
    <form id="purchaseForm">
        <label for="storeName">اسم المحل:</label>
        <input type="text" id="storeName" name="storeName" required>
        
        <label for="representativeName">اسم المندوب:</label>
        <input type="text" id="representativeName" name="representativeName" required>
        
        <label for="doctorList">اسم الطبيب القريب:</label>
        <div id="doctor-list">
            <input type="text" name="doctorName[]" required>
        </div>
        <button type="button" id="addDoctor">إضافة طبيب آخر</button>
        
        <label for="image">إرفاق صور:</label>
        <input type="file" id="image" name="image[]" accept="image/*" multiple required>
        
        <div id="product-list">
            <div class="product-item">
                <label for="type">نوع المنتج:</label>
                <select name="type[]" required>
                    <option value="">اختر نوع المنتج</option>
                    <option value="S1 400">S1 400</option>
                    <option value="S1 900">S1 900</option>
                    <option value="S2 400">S2 400</option>
                    <option value="S2 900">S2 900</option>
                    <option value="S3 400">S3 400</option>
                    <option value="S3 900">S3 900</option>
                    <option value="S3 1.7">S3 1.7</option>
                    <option value="LF">LF</option>
                    <option value="Comfort">Comfort</option>
                    <option value="Pre">Pre</option>
                    <option value="EvoSure">EvoSure</option>
                    <option value="AR">AR</option>
                </select>
                
                <label for="quantity">الكمية:</label>
                <input type="number" name="quantity[]" required>
            </div>
        </div>
        
        <button type="button" id="addProduct">إضافة منتج آخر</button>
        <input type="hidden" id="timestamp" name="timestamp">
        <button type="submit">إرسال</button>
    </form>

    <script>
        const motivationalMessages = [
            "أحسنت! جهدك اليوم يُحدث فرقًا.",
            "عمل رائع! استمر في التميز.",
            "أداءك الاحترافي يعكس التزامك.",
            "نجاحك هو نجاح الفريق بأكمله.",
            "تستحق كل التقدير على جهدك!",
            "إبداعك يرفع من مستوى العمل.",
            "جهدك لا يمر دون ملاحظة!",
            "استمر، النجاح في طريقك!",
            "تقديرًا لجهدك، نحن ممتنون لك.",
            "خطوة إضافية منك تساوي نجاحًا أكبر.",
            "ثقتنا بك تزداد يومًا بعد يوم.",
            "كن دائمًا الأفضل، وأنت كذلك!",
            "شكرًا لمساهمتك الفعالة!",
            "كل جهد تبذله ينعكس إيجابيًا.",
            "أنت عنصر أساسي في نجاحنا.",
            "إنجازك اليومي يصنع الفرق!",
            "احترافك ملهم للجميع.",
            "جهودك تبني المستقبل!",
            "لا شيء يضاهي حماسك وتفانيك!",
            "معك نصل لأعلى المستويات!"
        ];

        document.getElementById('addDoctor').addEventListener('click', function() {
            const doctorList = document.getElementById('doctor-list');
            const newDoctor = document.createElement('input');
            newDoctor.type = "text";
            newDoctor.name = "doctorName[]";
            newDoctor.required = true;
            doctorList.appendChild(newDoctor);
        });

        document.getElementById('addProduct').addEventListener('click', function() {
            const productList = document.getElementById('product-list');
            const newProduct = document.createElement('div');
            newProduct.classList.add('product-item');
            newProduct.innerHTML = `
                <label for="type">نوع المنتج:</label>
                <select name="type[]" required>
                    <option value="">اختر نوع المنتج</option>
                    <option value="S1 400">S1 400</option>
                    <option value="S1 900">S1 900</option>
                    <option value="S2 400">S2 400</option>
                    <option value="S2 900">S2 900</option>
                    <option value="S3 400">S3 400</option>
                    <option value="S3 900">S3 900</option>
                    <option value="S3 1.7">S3 1.7</option>
                    <option value="LF">LF</option>
                    <option value="Comfort">Comfort</option>
                    <option value="Pre">Pre</option>
                    <option value="EvoSure">EvoSure</option>
                    <option value="AR">AR</option>
                </select>
                
                <label for="quantity">الكمية:</label>
                <input type="number" name="quantity[]" required>
            `;
            productList.appendChild(newProduct);
        });

        document.getElementById('purchaseForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const timestamp = new Date().toLocaleString('ar-EG');
            document.getElementById('timestamp').value = timestamp;
    
            const productItems = document.querySelectorAll('.product-item');
    
            for (let i = 0; i < productItems.length; i++) {
                let singleFormData = new FormData();
                
                singleFormData.append("storeName", document.getElementById("storeName").value);
                singleFormData.append("representativeName", document.getElementById("representativeName").value);
                singleFormData.append("timestamp", timestamp);
    
                document.querySelectorAll('input[name="doctorName[]"]').forEach(doctor => {
                    singleFormData.append("doctorName[]", doctor.value);
                });
    
                let productType = productItems[i].querySelector('select[name="type[]"]').value;
                let quantity = productItems[i].querySelector('input[name="quantity[]"]').value;
    
                singleFormData.append("type", productType);
                singleFormData.append("quantity", quantity);
                
                const images = document.getElementById("image").files;
                for (let img of images) {
                    singleFormData.append("image[]", img);
                }
    
                try {
                    const response = await fetch('https://script.google.com/macros/s/AKfycbyeeoLRQbIMa9RkCuHGK-29adq4ZBi-PfpbMvHY_BamudWiGGFE27z9MNoMkdqrHXpP1g/exec', {
                        method: 'POST',
                        body: singleFormData
                    });
    
                    const result = await response.text();
                    
                    if (!result.includes("Success")) {
                        alert(`⚠ حدث خطأ أثناء إرسال المنتج ${i + 1}: ${result}`);
                        return;
                    }
                } catch (error) {
                    alert(`❌ خطأ في الاتصال عند إرسال المنتج ${i + 1}: ${error.message}`);
                    return;
                }
            }
    
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            alert(`تم إرسال البيانات بنجاح!

${randomMessage}

تحياتي،
علي عبود`);
            document.getElementById('purchaseForm').reset();
        });
    </script>
</body>
</html>
